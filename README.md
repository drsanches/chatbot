# chatbot

### Инструкция по развертыванию

##### Для запуска проекта необходимо:
* java 1.8
* maven 3.6.3

##### Настройка туннелирования (Если у Вас имеется статический адрес с доступом из внешней сети, то данный шаг можно пропустить): 
1. Необходимо скачать **ngrok**
2. Запустить **ngrok** 
    ```
    ngrok http 8080
3. В строке **Forwarding** появится надпись вида:
    ```
    http://xxxxxxxxxxxx.ngrok.io -> http://localhost:8080
4. По адресу http://xxxxxxxxxxxx.ngrok.io можно будет получить доступ к приложению
**ПРИМЕЧАНИЕ: При каждом запуске бесплатной версии ngrok адрес будет разным**

##### Подготовка:
1. Создать сообщество в VK.
2. Во вкладке **Работа с API** в настройках группы нужно создать ключ. Данный ключ необходимо сохранить, он потребуется далее.
3. Во вкладке **Callback API** необходимо выбрать версию API 5.50 и ввести адрес:
    ```
    http://xxxxxxxxxxxx.ngrok.io/callback
5. Также на вкладке **Callback API** находится group_id и строка подтверждения, которые потребуются далее.
6. Во вкладке **Типы событий** необходимо выбрать **Входящие сообщения**.

##### Конфигурирование приложения:
1. В проекте открыть конфигурационный файл 
    ```
    \src\main\resources\application.yml
2. В файле нужно заменить:
    * значение **group_id** на group_id со вкладки CallbackAPI в настройках сообщества;
    * значение **confirm_code** на строку подтверждения с той же вкладки;
    * значение **access_token** на сохраненный ранее ключ доступа.

#####Сборка и запуск приложения:
1. В директории с проектом нужно выполнить команду 
    ```
    mvn clean package
2. В папке target будет находиться файл 
    ```
    ChatBot-1.0-SNAPSHOT-spring-boot.jar
3. Для запуска приложения необходимо выполнить команду
    ```
    java -jar ChatBot-1.0-SNAPSHOT-spring-boot.jar
4. Сервер будет готов к работе после вывода сообщения 
    ```
    Started Application in x.xxx seconds

##### Подтверждение сервера:
Для получения уведомлений с VK необходимо подтвердить сервер. 
Для этого нужно нажать кнопку **Подтвердить** на вкладке "Callback API".
Строка подтверждения изменяется со временем, так что нужно следить, чтобы после запуска приложения она осталась актуальной. 

**После успешного выполнения всех операций бот будет готов к работе.**

Вся бизнес логика проекта покрыта тестами, которые запускаются перед сборкой jar-файла. 
Запустить тесты без сборки можно командой:
1. ```
    mvn test